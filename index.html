<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Awtrix Controller</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">
    
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    
    <style>
        /* --- ESTILOS (Idénticos a la v3.1) --- */
        :root {
            --bg-body: #F4F6F8; --bg-card: #FFFFFF; --text-primary: #2C3E50;
            --text-secondary: #95A5A6; --accent-blue: #AED6F1; --accent-blue-dark: #5DADE2;
            --accent-green: #A9DFBF; --accent-red: #F5B7B1; --input-bg: #F8F9F9;
            --border: #EBEDEF; --radius: 16px; --shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body); color: var(--text-primary); margin: 0; padding: 0;
            min-height: 100vh; display: flex; flex-direction: column; padding-bottom: 80px;
        }
        header {
            background: var(--bg-card); padding: 20px; padding-top: max(20px, env(safe-area-inset-top));
            text-align: center; box-shadow: 0 1px 10px rgba(0,0,0,0.03); position: sticky; top: 0; z-index: 100;
        }
        h1 { margin: 0; font-size: 1.1rem; font-weight: 600; color: var(--text-primary); }
        .status-dot {
            display: inline-block; width: 8px; height: 8px; border-radius: 50%;
            background-color: var(--text-secondary); margin-right: 6px; transition: background-color 0.3s;
        }
        .status-dot.connected { background-color: #58D68D; }
        .status-dot.error { background-color: #E74C3C; }
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .card {
            background: var(--bg-card); border-radius: var(--radius); padding: 20px;
            box-shadow: var(--shadow); margin-bottom: 20px;
        }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px; font-weight: 500; }
        input[type="text"], input[type="number"], input[type="password"], select {
            width: 100%; padding: 14px; border: 1px solid var(--border); border-radius: 12px;
            background: var(--input-bg); font-size: 1rem; color: var(--text-primary); outline: none; transition: border 0.2s;
        }
        input:focus { border-color: var(--accent-blue-dark); }
        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 1rem; font-weight: 600;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s, opacity 0.2s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background-color: var(--accent-blue-dark); color: white; }
        .btn-secondary { background-color: var(--input-bg); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-danger { background-color: var(--accent-red); color: #C0392B; }
        .btn-success { background-color: var(--accent-green); color: #196F3D; }
        .btn-row { display: flex; gap: 10px; margin-top: 10px; }
        .icon-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .icon-item {
            background: var(--input-bg); border: 1px solid var(--border); border-radius: 12px; padding: 8px;
            text-align: center; cursor: pointer; transition: transform 0.1s;
        }
        .icon-item:active { transform: scale(0.95); background: var(--accent-blue); }
        .icon-item img { width: 100%; height: auto; border-radius: 4px; image-rendering: pixelated; }
        .icon-id { font-size: 0.65rem; color: var(--text-secondary); margin-top: 5px; font-family: monospace; }
        .external-link {
            display: block; text-align: center; color: var(--accent-blue-dark); text-decoration: none;
            font-size: 0.9rem; margin-top: 20px; padding: 15px; background: var(--input-bg); border-radius: 12px;
        }
        .color-picker-wrapper { display: flex; align-items: center; background: var(--input-bg); border-radius: 12px; padding: 5px; border: 1px solid var(--border); }
        input[type="color"] { border: none; width: 40px; height: 40px; background: none; cursor: pointer; }
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; padding: 10px 0; }
        input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--accent-blue-dark); }
        .preset-item { display: flex; justify-content: space-between; align-items: center; background: var(--input-bg); padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--border); }
        .preset-info { flex-grow: 1; }
        .preset-title { font-weight: 600; font-size: 0.95rem; }
        .preset-detail { font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px; }
        .preset-actions { display: flex; gap: 10px; }
        .icon-btn { background: none; border: none; cursor: pointer; padding: 5px; color: var(--text-secondary); }
        nav {
            position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            border-top: 1px solid var(--border); display: flex; justify-content: space-around;
            padding-bottom: max(10px, env(safe-area-inset-bottom)); padding-top: 10px; z-index: 100;
        }
        .nav-item { flex: 1; text-align: center; color: var(--text-secondary); font-size: 0.65rem; cursor: pointer; padding: 5px; }
        .nav-item.active { color: var(--accent-blue-dark); }
        .nav-icon { display: block; width: 24px; height: 24px; margin: 0 auto 4px; fill: currentColor; }
    </style>
</head>
<body>

<header>
    <h1><span class="status-dot" id="statusDot"></span> Control Awtrix</h1>
</header>

<section id="tab-control" class="tab-content active">
    <div class="card">
        <div class="input-group">
            <label>Mensaje</label>
            <input type="text" id="msgText" placeholder="Escribe tu mensaje...">
        </div>

        <div class="input-group">
            <label>Estilo</label>
            <div class="color-picker-wrapper">
                <input type="color" id="msgColor" value="#FFFFFF">
                <span style="margin-left:10px; font-size:0.9rem; color:var(--text-secondary);">Color del texto</span>
            </div>
            <div class="checkbox-wrapper">
                <input type="checkbox" id="rainbowCheck">
                <label for="rainbowCheck" style="margin:0">Efecto Arcoíris</label>
            </div>
        </div>

        <div class="input-group">
            <label>Icono (ID)</label>
            <input type="text" id="iconInput" placeholder="Ej: 52">
        </div>

        <div class="input-group">
            <label>Posición del Icono</label>
            <select id="iconPosition">
                <option value="left">Izquierda</option>
                <option value="right">Derecha</option>
                <option value="both">Ambos lados</option>
                <option value="none">Ninguno</option>
            </select>
        </div>

        <div class="input-group">
            <label>Sonido & Duración</label>
            <div style="display:flex; gap:10px;">
                <select id="soundSelect" style="flex:1">
                    <option value="">Sin Sonido</option>
                    <option value="beep">Beep (Simple)</option>
                    <option value="ding">Ding Dong</option>
                    <option value="mario">Mario Coin</option>
                    <option value="starwars">Star Wars</option>
                    <option value="nokia">Nokia</option>
                    <option value="tetris">Tetris</option>
                </select>
                <input type="number" id="durationInput" value="5" placeholder="Seg" style="width:80px;">
            </div>
        </div>

        <button class="btn btn-primary" onclick="sendMessage()">
            <svg class="nav-icon" style="width:20px; margin:0;" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            Enviar al Reloj
        </button>
        
        <div class="btn-row">
            <button class="btn btn-secondary" onclick="saveToPresets()">
                <svg class="nav-icon" style="width:18px; margin:0;" viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
                Guardar
            </button>
        </div>
    </div>
</section>

<section id="tab-presets" class="tab-content">
    <div class="card">
        <label>Mensajes Guardados</label>
        <div id="presetsList">
            <div style="text-align:center; color:#aaa; padding:20px;">No hay mensajes guardados</div>
        </div>
    </div>
    <div class="card">
        <label>Gestión</label>
        <div class="btn-row">
            <button class="btn btn-secondary" onclick="exportPresets()">Exportar</button>
            <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">Importar</button>
            <input type="file" id="fileInput" style="display:none" onchange="importPresets(this)">
        </div>
        <div class="btn-row" style="margin-top:10px;">
            <button class="btn btn-danger" onclick="clearAllPresets()">Borrar Todo</button>
        </div>
    </div>
</section>

<section id="tab-icons" class="tab-content">
    <div class="card">
        <label>Iconos Populares</label>
        <div class="icon-grid" id="iconGrid"></div>
    </div>
    
    <a href="https://developer.lametric.com/icons" target="_blank" class="external-link">
        ¿No encuentras el icono?<br>
        <strong>Abrir Galería Oficial ↗</strong>
    </a>
</section>

<section id="tab-settings" class="tab-content">
    <div class="card">
        <div style="background: #FEF9E7; padding:15px; border-radius:12px; margin-bottom:20px; border:1px solid #F9E79F;">
            <strong style="color:#D4AC0D; display:block; margin-bottom:5px;">⚠️ Configuración Local</strong>
            <span style="font-size:0.8rem; color:#7F8C8D;">Tus credenciales se guardan solo en este navegador.</span>
        </div>

        <div class="input-group">
            <label>Prefijo MQTT (Sin barras)</label>
            <input type="text" id="mqttPrefix" placeholder="Ej: mi_casa_prefix">
        </div>

        <div class="input-group">
            <label>Broker URL (Websocket)</label>
            <input type="text" id="mqttBroker" value="wss://broker.emqx.io:8084/mqtt">
            <span style="font-size:0.75rem; color:#E74C3C; display:block; margin-top:5px;">
                *NO usar puerto 1883. Usar 8083 o 8084 para Web.
            </span>
        </div>

        <div class="input-group">
            <label>Usuario (Opcional)</label>
            <input type="text" id="mqttUser" placeholder="Usuario">
        </div>

        <div class="input-group">
            <label>Contraseña (Opcional)</label>
            <input type="password" id="mqttPass" placeholder="Contraseña">
        </div>

        <button class="btn btn-success" onclick="saveSettings()">Guardar y Conectar</button>
    </div>
</section>

<nav>
    <div class="nav-item active" onclick="switchTab('tab-control', this)">
        <svg class="nav-icon" viewBox="0 0 24 24"><path d="M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7l-2 3v1h8v-1l-2-3h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H3V4h18v12z"/></svg>
        Panel
    </div>
    <div class="nav-item" onclick="switchTab('tab-presets', this)">
        <svg class="nav-icon" viewBox="0 0 24 24"><path d="M4 10h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2zm0 10h12c1.1 0 2-.9 2-2v-4c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2zM20 4v16h2V4h-2z"/></svg>
        Guardados
    </div>
    <div class="nav-item" onclick="switchTab('tab-icons', this)">
        <svg class="nav-icon" viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
        Iconos
    </div>
    <div class="nav-item" onclick="switchTab('tab-settings', this)">
        <svg class="nav-icon" viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
        Ajustes
    </div>
</nav>

<script>
    // --- PARTITURAS RTTTL (La solución para relojes vacíos) ---
    const RTTTL_LIBRARY = {
        'beep': 'Beep:d=4,o=5,b=160:16p,16c5',
        'ding': 'DingDong:d=4,o=5,b=100:32p,16e6,16c6',
        'mario': 'MarioCoin:d=4,o=5,b=100:32p,16b5,16e6',
        'starwars': 'StarWars:d=4,o=5,b=45:32p,32f5,32f5,32f5,8b.5,16f.5,32e5,32d#5,32c#5,8b.5,16f.5,32e5,32d#5,32c#5,8b.5,16f.5,32e5,32d#5,32e5,8c#.5',
        'nokia': 'Nokia:d=4,o=5,b=160:8e6,8d6,16f#,16g#,8c#6,8b5,16d,16e,8b,8a,16c#,16e,2a',
        'tetris': 'Tetris:d=4,o=5,b=160:e6,8b,8c6,8d6,16e6,16d6,8c6,8b,a,8a,8c6,e6,8d6,8c6,b,8b,8c6,d6,e6,c6,a,2a,8p,d6,8f6,a6,8g6,8f6,e6,8c6,e6,8d6,8c6,b,8b,8c6,d6,e6,c6,a,2a'
    };

    // --- VARIABLES GLOBALES ---
    let client = null;
    let config = { prefix: '', broker: 'wss://broker.emqx.io:8084/mqtt', user: '', pass: '' };
    let presets = [];
    const curatedIcons = [
        {id: "626", name: "Sun"}, {id: "2356", name: "Rain"}, {id: "2350", name: "Storm"}, {id: "12563", name: "Snow"},
        {id: "52", name: "Smile"}, {id: "2474", name: "Heart"}, {id: "77", name: "Warning"}, {id: "356", name: "Check"},
        {id: "32", name: "Fb"}, {id: "44", name: "Insta"}, {id: "1157", name: "YTube"}, {id: "19323", name: "Twitch"},
        {id: "349", name: "Wifi"}, {id: "1724", name: "Mail"}, {id: "2282", name: "Msg"}, {id: "262", name: "Call"},
        {id: "6294", name: "Mario"}, {id: "1056", name: "Pika"}, {id: "5437", name: "Pacman"}, {id: "528", name: "Ghost"},
        {id: "2132", name: "Home"}, {id: "155", name: "Light"}, {id: "524", name: "Temp"}, {id: "5080", name: "Plug"},
        {id: "236", name: "Bitcoin"}, {id: "20792", name: "Eth"}, {id: "2532", name: "Graph"}, {id: "213", name: "Dollar"},
        {id: "1187", name: "Coffee"}, {id: "1665", name: "Pizza"}, {id: "1899", name: "Beer"}, {id: "3892", name: "Cake"},
        {id: "392", name: "Car"}, {id: "282", name: "Bike"}, {id: "740", name: "Run"}, {id: "1165", name: "Gym"}
    ];

    document.addEventListener('DOMContentLoaded', () => {
        loadSettings();
        loadPresets();
        updatePresetsUI();
        renderIcons();
        if(!config.prefix) {
            alert('Por favor configura el PREFIJO en Ajustes.');
            document.querySelectorAll('.nav-item')[3].click();
        } else {
            connectMQTT();
        }
    });

    function renderIcons() {
        document.getElementById('iconGrid').innerHTML = curatedIcons.map(icon => `
            <div class="icon-item" onclick="selectIcon('${icon.id}')">
                <img src="https://developer.lametric.com/content/apps/icon_thumbs/${icon.id}.png" loading="lazy">
                <div class="icon-id">${icon.id}</div>
            </div>
        `).join('');
    }

    function selectIcon(id) {
        document.getElementById('iconInput').value = id;
        document.querySelectorAll('.nav-item')[0].click();
        const input = document.getElementById('iconInput');
        input.style.backgroundColor = '#e8f8f5';
        setTimeout(() => input.style.backgroundColor = '', 500);
    }

    function switchTab(tabId, navElement) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        navElement.classList.add('active');
    }

    function loadSettings() {
        const stored = localStorage.getItem('awtrix_config');
        if (stored) {
            config = JSON.parse(stored);
            document.getElementById('mqttPrefix').value = config.prefix;
            document.getElementById('mqttBroker').value = config.broker;
            document.getElementById('mqttUser').value = config.user;
            document.getElementById('mqttPass').value = config.pass;
        }
    }

    function saveSettings() {
        const rawPrefix = document.getElementById('mqttPrefix').value.trim();
        config = {
            prefix: rawPrefix.replace(/\/$/, ''),
            broker: document.getElementById('mqttBroker').value.trim(),
            user: document.getElementById('mqttUser').value.trim(),
            pass: document.getElementById('mqttPass').value.trim()
        };
        if(!config.prefix) { alert("El prefijo es obligatorio"); return; }
        localStorage.setItem('awtrix_config', JSON.stringify(config));
        document.getElementById('mqttPrefix').value = config.prefix;
        alert('Configuración guardada en local.');
        connectMQTT();
    }

    function connectMQTT() {
        const statusDot = document.getElementById('statusDot');
        if (client) { client.end(); }
        const options = { username: config.user, password: config.pass };
        client = mqtt.connect(config.broker, options);
        client.on('connect', () => { console.log('Conectado'); statusDot.className = 'status-dot connected'; });
        client.on('error', (err) => { console.error('Error MQTT', err); statusDot.className = 'status-dot error'; });
        client.on('offline', () => { statusDot.className = 'status-dot'; });
    }

    function sendMessage(payloadOverride = null) {
        if (!client || !client.connected) { alert("No conectado. Revisa los Ajustes."); return; }

        let payload = payloadOverride;
        if (!payload) {
            const text = document.getElementById('msgText').value;
            const iconVal = document.getElementById('iconInput').value;
            const position = document.getElementById('iconPosition').value;
            if(!text && !iconVal) { alert("Escribe algo..."); return; }

            payload = {};
            let finalMessage = text;

            if (position === 'left' && iconVal) payload.icon = iconVal;
            else if (position === 'right' && iconVal) finalMessage = `${text} (i:${iconVal})`;
            else if (position === 'both' && iconVal) { payload.icon = iconVal; finalMessage = `${text} (i:${iconVal})`; }

            payload.text = finalMessage;
            
            if (document.getElementById('rainbowCheck').checked) payload.rainbow = true;
            else payload.color = document.getElementById('msgColor').value;

            // --- CORRECCIÓN DE SONIDO ---
            const soundKey = document.getElementById('soundSelect').value;
            if(soundKey && RTTTL_LIBRARY[soundKey]) {
                // Enviamos la partitura cruda (RTTTL) en lugar del nombre del archivo
                payload.rtttl = RTTTL_LIBRARY[soundKey];
            }

            const duration = document.getElementById('durationInput').value;
            if(duration) payload.duration = parseInt(duration);
            
            payload.pushIcon = 0;
        }

        const topic = `${config.prefix}/notify`;
        client.publish(topic, JSON.stringify(payload));
        
        const btn = document.querySelector('.btn-primary');
        const oldColor = btn.style.backgroundColor;
        btn.style.backgroundColor = 'var(--accent-green)';
        setTimeout(() => btn.style.backgroundColor = oldColor, 500);
    }

    function loadPresets() {
        const stored = localStorage.getItem('awtrix_presets');
        if (stored) presets = JSON.parse(stored);
    }

    function saveToPresets() {
        const name = prompt("Nombre para este mensaje:");
        if (!name) return;
        const preset = {
            id: Date.now(), name: name,
            text: document.getElementById('msgText').value,
            icon: document.getElementById('iconInput').value,
            pos: document.getElementById('iconPosition').value,
            color: document.getElementById('msgColor').value,
            rainbow: document.getElementById('rainbowCheck').checked,
            sound: document.getElementById('soundSelect').value,
            duration: document.getElementById('durationInput').value
        };
        presets.push(preset);
        localStorage.setItem('awtrix_presets', JSON.stringify(presets));
        updatePresetsUI();
        alert("Guardado");
    }

    function updatePresetsUI() {
        const list = document.getElementById('presetsList');
        list.innerHTML = '';
        if(presets.length === 0) { list.innerHTML = '<div style="text-align:center; color:#aaa; padding:20px;">No hay mensajes guardados</div>'; return; }
        presets.forEach(p => {
            const item = document.createElement('div');
            item.className = 'preset-item';
            item.innerHTML = `
                <div class="preset-info" onclick="loadPreset(${p.id})">
                    <div class="preset-title">${p.name}</div>
                    <div class="preset-detail">${p.text.substring(0, 20)}...</div>
                </div>
                <div class="preset-actions">
                    <button class="icon-btn" onclick="deletePreset(${p.id})"><svg style="width:20px; height:20px;" viewBox="0 0 24 24"><path fill="#E74C3C" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></button>
                    <button class="icon-btn" onclick="loadAndSend(${p.id})"><svg style="width:20px; height:20px;" viewBox="0 0 24 24"><path fill="#58D68D" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
                </div>`;
            list.appendChild(item);
        });
    }

    function loadPreset(id) {
        const p = presets.find(x => x.id === id);
        if(!p) return;
        document.getElementById('msgText').value = p.text;
        document.getElementById('iconInput').value = p.icon;
        document.getElementById('iconPosition').value = p.pos;
        document.getElementById('msgColor').value = p.color;
        document.getElementById('rainbowCheck').checked = p.rainbow;
        document.getElementById('soundSelect').value = p.sound;
        document.getElementById('durationInput').value = p.duration;
        document.querySelectorAll('.nav-item')[0].click();
    }
    function loadAndSend(id) { loadPreset(id); sendMessage(); }
    function deletePreset(id) { if(!confirm("¿Borrar?")) return; presets = presets.filter(x => x.id !== id); localStorage.setItem('awtrix_presets', JSON.stringify(presets)); updatePresetsUI(); }
    function clearAllPresets() { if(!confirm("¿Borrar TODOS?")) return; presets = []; localStorage.setItem('awtrix_presets', JSON.stringify(presets)); updatePresetsUI(); }
    function exportPresets() { const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(presets)); const downloadAnchorNode = document.createElement('a'); downloadAnchorNode.setAttribute("href", dataStr); downloadAnchorNode.setAttribute("download", "awtrix_backup.json"); document.body.appendChild(downloadAnchorNode); downloadAnchorNode.click(); downloadAnchorNode.remove(); }
    function importPresets(input) { const file = input.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = function(e) { try { const imported = JSON.parse(e.target.result); if(Array.isArray(imported)) { presets = presets.concat(imported); localStorage.setItem('awtrix_presets', JSON.stringify(presets)); updatePresetsUI(); alert("Importado"); } } catch(err) { alert("Archivo corrupto"); } }; reader.readAsText(file); }
</script>

</body>
</html>
